/*Desenvolvido por Taffarel Xavier*/
jQuery(document).ready(function(){$(".tooltips").tooltip();$(".erro_ao_tentar_buscar_avaliacao,.error_avaliacao_nao_found")._neoPluginAlert({mensagem:"Ops, nenhuma avaliação encontrada.",tamanho:"0",tipoCor:"warning",link:"./"});jQuery.validator.addMethod("padrao_data",function(e,d){return this.optional(d)||/(^(((0[1-9]|[12][0-8])[\/](0[1-9]|1[012]))|((29|30|31)[\/](0[13578]|1[02]))|((29|30)[\/](0[4,6,9]|11)))[\/](19|[2-9][0-9])\d\d$)|(^29[\/]02[\/](19|[2-9][0-9])(00|04|08|12|16|20|24|28|32|36|40|44|48|52|56|60|64|68|72|76|80|84|88|92|96)$)/.test(e)},"Insira uma data no padrão de data dd/MM/yyyy");var a=$("#btnAvancarAvaliacao");a.click(function(){var d=$(this);d.text("Verificando avaliação anteriores, aguarde...").attr("disabled",true);$.post("models/verificar_igualdade_avaliacoes.php",{disciplina_id:$("#ava_elet_select_disciplinas").val().trim(),ava_descricao:$("#ava_descricao").val().trim()},function(e){if(e=="1"){$("#form_incluir_avaliacao").submit()}else{if(e=="2"){$("#form_incluir_avaliacao").submit()}else{if(confirm(e)){$("#form_incluir_avaliacao").submit()}else{d.text("Avançar").attr("disabled",false)}}}$(this).text("Avançar").attr("disabled",false)})});function c(d,e){$(d).focus();$("#btnAvancarAvaliacao").attr("disabled",false).html('<i class="icon-save"></i> Tentar novamente.');alert(e)}$("#form_incluir_avaliacao").ajaxForm({beforeSend:function(){var d=$(".selecionarTurmas").find("select")[0];if($("#ava_descricao").val().trim()==""){c("#ava_descricao","Insira a descrição...");return false}else{if($("#ava_elet_select_disciplinas").val().trim()==""){c("#ava_elet_select_disciplinas","Selecione a disciplina.");return false}else{if($("select[name='ava_turma[]']").attr("value")==""||d.selectedIndex=="-1"){c("select[name='ava_turma[]']","Selecione uma, duas ou mais turmas.");return false}else{if($("#date").val()==""){c("#date","Selecione a data.");return false}else{if(document.getElementById("tipo_das_questoes").selectedIndex==0){c("#tipo_das_questoes","Selecione o tipo das questões.");return false}else{if(document.getElementById("BimestreId").selectedIndex==0){c("#BimestreId","Escolha corretamente os bimestres.");return false}}}}}}a.text("Avançando...").attr("disabled",true)},success:function(f){var e=/\d+\-\d+/g;if(e.test(f)===true){a.text("Sucesso!").attr("disabled",false);$(this)._neoBeforeUnload(true,"Você está inserindo uma nova avaliação.");var d=f.split("-");window.location.href="?exe=editar&avaliacao-id="+d[1]+"&quant_questoes=10";$.cookie("nova_avaliacao","1")}else{a.text("Avançar").attr("disabled",false);alert(f)}},complete:function(d){}});$(".excluir_questoes").click(function(){var d=$(this).attr("data-exluir-id");if(confirm("Deseja realmente excluir esta questão?")){$.post("models/excluir-questao.php",{idqst:parseInt(d)},function(e){if(e==="1"){alert("Questão excluída com sucesso!");window.location.reload()}else{alert("Houve um erro.\n"+e)}})}});$(".pesoPorQuestao").keyup(function(f){var e=$(this).attr("id");if(f.keyCode==13){novoID=e.match(/\d+/gmi);id="#"+novoID;mybtn=$("#btn-salvar-alteracao-"+novoID);mybtn.text("Salvando...");desc=CKEDITOR.instances[novoID+"desc"].getData();resp_a=$(id+"resp_a").val().trim();resp_b=$(id+"resp_b").val().trim();resp_c=$(id+"resp_c").val().trim();resp_d=$(id+"resp_d").val().trim();resp_e=$(id+"resp_e").val().trim();peso=$(id+"peso").val().trim();qc=$(id+"qc").val().trim();var d={id:e,desc:desc,resp_a:resp_a,resp_b:resp_b,resp_c:resp_c,resp_d:resp_d,resp_e:resp_e,peso:peso,qc:qc};$.post("models/atualizar-questao.php",d,function(g){if(g==="1"){mybtn.text("Sucesso").slideUp(300).delay(800).text("Sucesso").fadeIn(400).text("Salvar alterações")}else{if(g=="2"){alert("A operação não pôde ser realizada porque está fora do prazo para alteração.");mybtn.text("Salvar alterações")}else{mybtn.text("Salvar alterações")}}})}});$(".salvar_questao").click(function(){mybtn=$(this);var d=$("#tipo-das-questoes").val();mybtn.text("Salvando...");var f=$(this).attr("data-exluir-id");id="#"+f;desc=CKEDITOR.instances[f+"desc"].getData();switch(d){case"1":resp_a=$(id+"resp_a").val().trim();resp_b=$(id+"resp_b").val().trim();resp_c=$(id+"resp_c").val().trim();resp_d=$(id+"resp_d").val().trim();resp_e=$(id+"resp_e").val().trim();peso=$(id+"peso").val().trim();qc=$(id+"qc").val().trim();file_a=$("#input_"+f+"_a").val().trim();file_b=$("#input_"+f+"_b").val().trim();file_c=$("#input_"+f+"_c").val().trim();file_d=$("#input_"+f+"_d").val().trim();file_e=$("#input_"+f+"_e").val().trim();var e={id:f,desc:desc,resp_a:resp_a,resp_b:resp_b,resp_c:resp_c,resp_d:resp_d,resp_e:resp_e,peso:peso,qc:qc,file_a:file_a,file_b:file_b,file_c:file_c,file_d:file_d,file_e:file_e};break;case"2":peso=$(id+"peso").val().trim();var e={id:f,desc:desc,peso:peso,qc:"1"};break;break}console.log(e);$.post("models/atualizar-questao.php",e,function(g){if(g==="0"){alert("Nenhum dado foi atualizado.");mybtn.text("Salvar alterações")}else{if(g==="1"){mybtn.text("Sucesso").slideUp(300).delay(800).text("Sucesso").fadeIn(400).text("Salvar alterações")}else{if(g==="2"){alert("A operação não pôde ser realizada porque está fora do prazo para alteração.");mybtn.text("Salvar alterações")}else{alert("Houve um erro.\nMensagem do erro:"+g);mybtn.text("Salvar alterações")}}}})});$("#form_alterar_avaliacao").ajaxForm({type:"post",url:"models/alterar-avaliacao.php",beforeSend:function(){$("#btnSalvarAlteracao").attr("disabled",true).html('Salvando alterações, aguarde. <i class="icon-save"></i>')},success:function(d){if(d=="10"){alert("Dados atualizados com sucesso!");window.location.reload()}else{if(d=="11"){alert("Dados atualizados com sucesso!");window.location.reload()}else{if(d=="00"){alert("Nenhum dados foi atualizado.");$("#btnSalvarAlteracao").attr("disabled",false).html('Tentar Novamente <i class="icon-save"></i>')}else{if(d=="0"){alert("Nenhum dados foi atualizado.");$("#btnSalvarAlteracao").attr("disabled",false).html('Tentar Novamente <i class="icon-save"></i>')}else{alert(d);$("#btnSalvarAlteracao").attr("disabled",false).html('Tentar Novamente <i class="icon-save"></i>')}}}}}});$("#excluir-avaliacao-permanente").click(function(){var e=$(this).attr("data-key");var d=$(this).attr("data-lugar");var f=parseInt($(this).attr("data-avaliacao-id"));$.post("models/excluir-avaliacao.php",{key:e,lugar:d,avaliacao_id:f},function(g){$.post("models/apagar-sessoes-avaliativas.php");if(g=="1"){alert("Avaliação excluída com sucesso!");window.location.href="./"}else{if(g=="0"){alert("Não foi possível fazer a exclusão.")}else{alert("Houve um erro.\n["+g+"]")}}})});$("#selecionar_tudo").click(function(){$("option").prop("selected",true);$("#taffarel_xavier").trigger("liszt:updated")});$("#remover_tudo").click(function(){$("option").prop("selected",false);$("#taffarel_xavier").trigger("liszt:updated")});if(jQuery().datepicker){$(".date-picker").datepicker({dateFormat:"dd/mm/yyyy"})}var b=function(){if(!jQuery().dataTable){return}jQuery(".table-taffarel").dataTable({aLengthMenu:[[10,25,50,-1],[5,15,20,"All"]],bOrder:[[0,"asc"],[1,"desc"]],sAjaxDataProp:"aaData",sPaginationType:"bootstrap",sScrollY:"500",bScrollCollapse:true,oSearch:{sSearch:""},iDisplayLength:5,sDom:"<'row-fluid'<'span6'l><'span6'f>r>t<'row-fluid'<'span6'i><'span6'p>>",oLanguage:{oPaginate:{sPrevious:"Anterior",sNext:"Próximo",sFirst:"Primeira página"},sZeroRecords:"Nenhum dado encontrado",sSearch:"Pesquisar",sEmptyTable:"No data available in table",sInfo:"Mostrando (_START_ até _END_) de _TOTAL_ registros."},aoColumnDefs:[{bSortable:true,aTargets:[0]},{bSortable:false,aTargets:[6]}],aaSorting:[[0,"desc"]]});jQuery(".table-taffarel .group-checkable").change(function(){var e=jQuery(this).attr("data-set");var d=jQuery(this).is(":checked");jQuery(e).each(function(){if(d){$(this).attr("checked",true)}else{$(this).attr("checked",false)}});jQuery.uniform.update(e)})};b()});